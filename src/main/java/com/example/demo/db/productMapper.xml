<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="product">

 <!-- 상품 home-->	
  <select id="findAll_home" resultType="productVO">
     select no ,pro_name, pro_brand, pro_price, pro_saleprice, PRO_THUMBNAIL
	 from product 
	 <if test="cat_code !=null">
	 		where cat_code=#{cat_code}
	 </if>
	 
	 <if test="keyword != null">
			where pro_name like '%'||#{keyword}||'%' 
	 </if>
	 
	 <if test="filter != null">
			order by ${filter} desc
	 </if>
	 
	 <if test="filterASC != null">
			order by ${filterASC}  
	 </if>
	 
 </select>
 
 
 
 
 
  <!-- 상품 admin-->	
  <select id="findAll" resultType="productVO">
     select no ,pro_name, pro_brand, pro_price, pro_saleprice, pro_stock, c.cat_name cat_name, PRO_THUMBNAIL
	from product p, category c
	where c.cat_code = p.cat_code
  </select>  
  
   <!-- 상품 detail product-->
  <select id="findByNo" resultType="productVO"> 
  	select * from product  
	where no=#{no} 
 </select>
  
   <!-- 상품 detail 한 개 옵션-->
 <select id="findOption" resultType="productVO">   		 
			select pro_option_name, pro_option_detail_name, pro_add_price, sum(pro_saleprice + pro_add_price)sum
			from pro_add_option pao,pro_option po, pro_option_detail pod, product p
			where pao.pro_option_code = po.pro_option_code and
			pao.pro_option_detail_code = pod.pro_option_detail_code and
			pro_no=#{no}
		    GROUP BY pro_option_name, pro_option_detail_name, pro_add_price		 
		    order by pro_option_name
 </select> 
 
  

 <select id="findOptionView" resultType="java.lang.Integer">   		
 	select count( distinct pro_option_code)cnt from pro_add_option where pro_no=#{no}
 </select>
  
  <insert id="insert" parameterType="productVO">
   	insert into product values(
    seq_product.nextval,
   #{pro_name},
    #{pro_brand},
    #{pro_price},
    #{pro_saleprice},
    #{pro_stock},
    #{pro_delivery},
             sysdate,
             0,             
    #{pro_content},
    #{cat_code},
    #{PRO_THUMBNAIL}
    )
  </insert>
  
  
   
   <!-- 상품 수정-->
  <update id="update" parameterType="productVO">
  	update product set pro_name=#{pro_name},pro_brand=#{pro_brand},pro_price=#{pro_price},pro_saleprice=#{pro_saleprice},pro_stock=#{pro_stock},pro_content=#{pro_content},PRO_THUMBNAIL=#{PRO_THUMBNAIL} where no=#{no}
  </update>
  
   <!-- 상품 삭제-->
  <delete id="delete">
  	delete product where no=#{no}
  </delete>
  
   <!-- 상품 조회수-->
  <update id="updateHit">
  	update product set pro_hit=pro_hit+1 where no=#{no}
  </update>
  
</mapper>